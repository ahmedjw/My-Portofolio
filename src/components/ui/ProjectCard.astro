---
interface Props {
  title: string;
  description: string;
  technologies: string[];
  slug: string;
  githubUrl?: string;
  liveUrl?: string;
}

const { title, description, technologies, slug, githubUrl, liveUrl } = Astro.props;
---

<div class="project-card" data-tilt>
  <div class="tilt-shine"></div>
  <a href={`/projects/${slug}/`} class="card-link" aria-label={`View details: ${title}`} transition:name={`project-title-${slug}`}></a>
  <div class="card-header">
    <svg class="folder-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
    </svg>
    <div class="card-links">
      {githubUrl && (
        <a href={githubUrl} target="_blank" rel="noopener noreferrer" aria-label={`GitHub: ${title}`}>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
        </a>
      )}
      {liveUrl && (
        <a href={liveUrl} target="_blank" rel="noopener noreferrer" aria-label={`Live demo: ${title}`}>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        </a>
      )}
    </div>
  </div>
  <h3>{title}</h3>
  <p>{description}</p>
  <div class="tech-tags">
    {technologies.map((tech) => <span class="tag">{tech}</span>)}
  </div>
  <span class="view-details">
    View details
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
  </span>
</div>

<style>
  .project-card {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: var(--space-8);
    box-shadow: var(--glass-shadow);
    transition: transform 0.4s ease, box-shadow 0.3s ease, border-color 0.3s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    overflow: hidden;
    transform-style: preserve-3d;
  }

  .project-card:hover {
    box-shadow: var(--shadow-accent);
    border-color: var(--color-primary-200);
  }

  .card-link {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .tilt-shine {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.15), transparent 60%);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1;
  }

  .project-card:hover .tilt-shine {
    opacity: 1;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-6);
  }

  .folder-icon {
    color: var(--color-primary-500);
  }

  .card-links {
    display: flex;
    gap: var(--space-3);
    position: relative;
    z-index: 1;
  }

  .card-links a {
    color: var(--color-text-muted);
    transition: color 0.2s ease;
    position: relative;
    z-index: 1;
  }

  .card-links a:hover {
    color: var(--color-primary-600);
  }

  h3 {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--color-text);
    margin-bottom: var(--space-3);
  }

  p {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    line-height: var(--leading-relaxed);
    flex: 1;
    margin-bottom: var(--space-6);
  }

  .tech-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-top: auto;
  }

  .tag {
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .view-details {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--color-primary-600);
    margin-top: var(--space-4);
    opacity: 0;
    transform: translateX(-4px);
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  .project-card:hover .view-details {
    opacity: 1;
    transform: translateX(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .tilt-shine {
      display: none;
    }
  }
</style>

<script>
  function initTilt() {
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    document.querySelectorAll<HTMLElement>('[data-tilt]').forEach((card) => {
      const shine = card.querySelector<HTMLElement>('.tilt-shine');

      card.addEventListener('mousemove', (e: MouseEvent) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        const rotateX = ((y - centerY) / centerY) * -5;
        const rotateY = ((x - centerX) / centerX) * 5;

        card.style.transform = `perspective(800px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;

        if (shine) {
          shine.style.background = `radial-gradient(circle at ${x}px ${y}px, rgba(255,255,255,0.18), transparent 60%)`;
        }
      });

      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
      });
    });
  }

  initTilt();
  document.addEventListener('astro:page-load', initTilt);
</script>
