---
const navLinks = [
  { label: 'About', href: '/#about' },
  { label: 'Skills', href: '/#skills' },
  { label: 'Experience', href: '/#experience' },
  { label: 'Projects', href: '/#projects' },
  { label: 'Blog', href: '/blog/' },
  { label: 'Contact', href: '/#contact' },
];
---

<header class="header" transition:persist>
  <nav class="container nav">
    <a href="/" class="logo">
      <span class="logo-text">A<span class="gradient-text">J</span></span>
    </a>

    <ul class="nav-links">
      {navLinks.map((link) => (
        <li><a href={link.href}>{link.label}</a></li>
      ))}
    </ul>

    <button class="mobile-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </button>

    <div class="mobile-menu">
      <ul>
        {navLinks.map((link) => (
          <li><a href={link.href}>{link.label}</a></li>
        ))}
      </ul>
    </div>
  </nav>
</header>

<style>
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: rgba(250, 251, 255, 0.8);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--glass-border);
    transition: background 0.3s ease, box-shadow 0.3s ease;
  }

  .header.scrolled {
    box-shadow: var(--shadow-md);
  }

  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 72px;
  }

  .logo {
    text-decoration: none;
  }

  .logo-text {
    font-size: var(--text-2xl);
    font-weight: 800;
    color: var(--color-text);
    letter-spacing: -0.02em;
  }

  .nav-links {
    display: flex;
    gap: var(--space-8);
  }

  .nav-links a {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-secondary);
    transition: color 0.2s ease;
    position: relative;
  }

  .nav-links a::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--gradient-primary);
    border-radius: var(--radius-full);
    transition: width 0.3s ease;
  }

  .nav-links a:hover {
    color: var(--color-primary-600);
  }

  .nav-links a:hover::after,
  .nav-links a.active::after {
    width: 100%;
  }

  .nav-links a.active {
    color: var(--color-primary-600);
  }

  /* Mobile toggle */
  .mobile-toggle {
    display: none;
    flex-direction: column;
    gap: 5px;
    padding: var(--space-2);
    z-index: 1002;
  }

  .bar {
    display: block;
    width: 24px;
    height: 2px;
    background: var(--color-text);
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .mobile-toggle[aria-expanded="true"] .bar:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }
  .mobile-toggle[aria-expanded="true"] .bar:nth-child(2) {
    opacity: 0;
  }
  .mobile-toggle[aria-expanded="true"] .bar:nth-child(3) {
    transform: rotate(-45deg) translate(5px, -5px);
  }

  /* Mobile menu */
  .mobile-menu {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(250, 251, 255, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    z-index: 1001;
    align-items: center;
    justify-content: center;
  }

  .mobile-menu.open {
    display: flex;
  }

  .mobile-menu ul {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-8);
  }

  .mobile-menu a {
    font-size: var(--text-2xl);
    font-weight: 600;
    color: var(--color-text);
    transition: color 0.2s ease;
  }

  .mobile-menu a:hover {
    color: var(--color-primary-600);
  }

  @media (max-width: 768px) {
    .nav-links {
      display: none;
    }
    .mobile-toggle {
      display: flex;
    }
  }
</style>

<script>
  function initHeader() {
    const header = document.querySelector('.header');
    const toggle = document.querySelector('.mobile-toggle');
    const menu = document.querySelector('.mobile-menu');

    if (!header || !toggle || !menu) return;

    // Scroll shadow
    function onScroll() {
      header.classList.toggle('scrolled', window.scrollY > 10);
    }
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();

    // Mobile menu
    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!expanded));
      menu.classList.toggle('open');
      document.body.style.overflow = expanded ? '' : 'hidden';
    });

    // Close menu on link click
    menu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        toggle.setAttribute('aria-expanded', 'false');
        menu.classList.remove('open');
        document.body.style.overflow = '';
      });
    });

    // Active section highlighting (scroll spy)
    const navAnchors = document.querySelectorAll<HTMLAnchorElement>('.nav-links a[href^="/#"]');
    const sectionIds = Array.from(navAnchors)
      .map((a) => a.getAttribute('href')?.replace('/#', ''))
      .filter(Boolean) as string[];

    const sections = sectionIds
      .map((id) => document.getElementById(id))
      .filter(Boolean) as HTMLElement[];

    if (sections.length) {
      const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting) return;
          const id = entry.target.id;
          navAnchors.forEach((a) => {
            const href = a.getAttribute('href');
            a.classList.toggle('active', href === `/#${id}`);
          });
        });
      }, { rootMargin: '-20% 0px -60% 0px' });

      sections.forEach((s) => sectionObserver.observe(s));
    }
  }

  initHeader();
  document.addEventListener('astro:page-load', initHeader);
</script>
